---
layout: post
title:  "栈溢出利用条件分析"
date:   2025-04-18 18:27:38 +0800
category: userspace
---
是不是下面这些问题解决了，才会有后面的地址泄露、rop执行、shellcode执行这些利用手段？

这些问题不回答清楚，往往后面的事情想了一半才发现前面的条件不满足，又回过头来思考前面这些问题，造成了时间的浪费，精力的损耗。

# 栈溢出关注的点

是不是下面这些问题解决了，才会有后面的地址泄露、rop执行、shellcode执行这些利用手段？

这些问题不回答清楚，往往后面的事情想了一半才发现前面的条件不满足，又回过头来思考前面这些问题，造成了时间的浪费，精力的损耗。

- 保护情况怎么样？按照关注度排序
    - Canary，有了它是不是直接就宣告死亡了？
    - NX
    - ASLR、PIE
    
- 是否可以交互？

这个决定了后面的漏洞利用是payload一把梭哈，还是可以多次交互把漏洞利用过程分为多步来实现

- 覆盖的长度是多少？
    - 部分覆盖返回地址，那么就只能做partial overwrite返回到有限的地址范围
    - 完全覆盖返回地址
    - 往返回地址后面继续覆盖
        - 返回地址后面还可以写有限个字节，rop或者shellcode要控制长度
        - 无限长度写，任意长度rop或者shellcode
- 攻击者对覆盖的内容是否可控？
    - 完全可控，不添加任何其他内容
    - 部分可控，程序会往中间或者两头加入东西，或者做内容过滤
        - 末尾写0
        - 末尾写入其他字符串
        - 如果有内容过滤，那么payload要尝试避开这些东西
- 是否存在NULL字符截断？
    - 不存在，攻击者可以往栈上面写NULL
    - 存在，一旦写入NULL就会截断

以上这些点既是具体问题的抽象总结，又离不开具体问题具体分析！

以上栈溢出漏洞条件的每一种排列组合情况，如果人类都能够找到利用的方式，那么机器也应该可以学会。

strcpy溢出，要解决x64模式下的0截断问题

# 栈溢出的一些终止条件

- 遇到Canary
- （x64环境下） && （ 存在NULL字符截断） && （末尾会添加攻击者不可控的内容）
    - [crashmail](https://www.notion.so/Crashmail-1-6-1d73f4b7819d8049b9fcfc9dff8a19ae?pvs=21)栈溢出
    - [exim](https://www.notion.so/Exim-4-41-dns_build_reverse-1c23f4b7819d80f490c3e4fc91884fe7?pvs=21)栈溢出